<html>
    <head>
        <title>The Antonym Game</title>
        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
        <script>
            var wordList = [{% for word in words %}'{{word.name}}'{% if not forloop.last %},{% endif %}{% endfor %}];
            function pickWord(){
                var word = wordList[parseInt(Math.random()*wordList.length)];
                $('.next').hide();
                $('.word').text(word);
                $('#response').val('');
                $('input').removeAttr('disabled');
                $('#response').focus();
                $('.results').empty();
            }
            $(function(){
                $('form').submit(function(evt){
                    evt.preventDefault();
                    var response = $('#response').val();
                    if(!response.length)
                        return;
                    $('.next').show();
                    $('input').attr('disabled', 'disabled');
                    $('#response').blur();
                    $.ajax({
                        type: 'post',
                        url: '/respond/' + $('.word').text() + '/' + response,
                        dataType: 'json',
                        success: function(data){
                            var count = 0;
                            for(var i=0; i<data.length; i++){
                                var d = data[i];
                                count += d.count;
                            }
                            for(var i=0; i<data.length; i++){
                                var d = data[i];
                                var percent = parseInt(100 * d.count / count);
                                $('.results').append('<div class="results-row"><span class="response">' + d.response +
                                        '</span><span class="bar"><span class="bar-inner" style="width:' + percent +
                                        '%"></span></span><span class="percent">' + percent + '%</span></div>')
                            }
                        }
                    })

                });
                $('#response').keyup(function(){
                    $('#response').val($('#response').val().replace(/[^A-Za-z ]/g, '').toLowerCase());
                });
                $(document).keydown(function(evt){
                    if($('#response').attr('disabled') && evt.which == 13){
                        setTimeout(function(){
                            pickWord();
                        }, 10);
                    }
                });
                pickWord();
            });
        </script>
    </head>
    <body>
        <div class="container">
            <div class="header">
                <h1>The Antonym Game</h1>
            </div>
            <div class="word">

            </div>
            <div class="input">
                <form>
                    <input type="text" id="response">
                    <input type="submit" value="Submit">
                </form>
            </div>
            <div class="results">

            </div>
            <div class="next">
                Press enter to continue
            </div>
        </div>
    </body>
</html>